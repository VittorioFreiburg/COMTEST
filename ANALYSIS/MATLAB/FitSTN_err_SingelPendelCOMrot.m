%	 FitSTN_err_SingelPendelCOMrot.m		10-Nov-04 --> 11.6.2012function [mse,g] = FitSTN_err_SingelPendelCOMrot(PID_fit)g=0;ki=PID_fit(1);kp=PID_fit(2);kd=PID_fit(3);wp=PID_fit(4);td=PID_fit(5);kpas=PID_fit(6);bpas=PID_fit(7);kpas=90;bpas=60;ki = 100;if ki<0; ki=0; end%if wp>1; wp=1; end%if td<0.1; td=0.1; end%load ModelParasBasisTF = ModelParas.basis.TF;Fd = ModelParas.basis.f ;J = ModelParas.basis.J;mgh = ModelParas.basis.mgh;w=2*pi*Fd;s=j*w;Bi=J*s.*s-mgh*ones(size(w));TD=cos(w*td)-j*sin(w*td);PIDTD=(kd*(s.*s)+kp*s+ki).*TD;num=wp*PIDTD+kpas*s+bpas*(s.*s);              %  tilt experiment Tc vs. FSden=s.*Bi+PIDTD+kpas*s+bpas*(s.*s);            %  tilt experiment Tc vs. FStf=num./den;d2=(TF-tf)./abs(TF+tf);	% normalize individual vectors by magnitude of fit at each frequencymse=mean(d2(2:end-1).*conj(d2(2:end-1)));