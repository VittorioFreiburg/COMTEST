%	 FitSTN_err.m		10-Nov-04function [mse,g] = FitSTN_err(PID_fit)global Fd TF J mgh ms;g=0;ki=PID_fit(1);kp=PID_fit(2);kd=PID_fit(3);wp=PID_fit(4);td=PID_fit(5);kpas=PID_fit(6);bpas=PID_fit(7);%%  Form Transfer Function estimate from current  parameters% if wp>1; wp=1; end% if ki<0; ki=0; end%% if td<0.1; td=0.1; end%kpas=90;bpas=60;ki = 100;% ki=kp/10;                if ki<0; ki=0; end%                             if wp>1; wp=1; end%                                if td<0.1; td=0.1; end%                %                 if kp<10; Kp=0; end%                 if kd<0; kd=0; end%                 if wp<0; wp=0; end                   %                 if kpas<0; kpas=0; end%                 if bpas<0; bpas=0; end%                 kpas=90;%                 bpas=90;%                 ki=kp/10;%                 ki = 100    w=2*pi*Fd;    s=j*w;    Bi=J*s.*s-mgh*ones(size(w));    TD=cos(w*td)-j*sin(w*td);    PIDTD=(kd*(s.*s)+kp*s+ki).*TD;    num=wp*PIDTD+kpas*s+bpas*(s.*s);              %  tilt experiment Tc vs. FS    den=s.*Bi+PIDTD+kpas*s+bpas*(s.*s);            %  tilt experiment Tc vs. FS% 			num=Wp/9.81/ms*PIDTD;              %  tilt experiment Tc vs. FS% 			den=s+PIDTD./Bi;            %  tilt experiment Tc vs. FS% 		num=-PIDTD.*s.*s;           %  trans experiment Tc vs. Text% 		den=s.*Bi+PIDTD;            %  trans experiment Tc vs. Text    tf=num./den;    %    % fit error    %    d2=(TF-tf)./abs(TF+tf);	% normalize individual vectors by magnitude of fit at each frequency% 		mse=mean(d2(3:end-3).*conj(d2(3:end-3)));    mse=mean(d2(2:end-1).*conj(d2(2:end-1)));%e=[mse ki*pi/180 kp*pi/180 kd*pi/180 J kt td];