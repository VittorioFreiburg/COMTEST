%   This program is free software: you can redistribute it and/or modify it
%   under the terms of the GNU General Public License as published by
%   the Free Software Foundation, either version 3 of the License, or
%   (at your option) any later version.
%   
%   This program is distributed in the hope that it will be useful, but
%   WITHOUT ANY WARRANTY; without even the implied warranty of
%   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%   GNU General Public License for more details.
%   
%   You should have received a copy of the GNU General Public License
%   along with this program.  If not, see
%   <https://www.gnu.org/licenses/>.
%  
%   This function creates a structure with the PI(s) associated with the PRTS stimulus
%   s = PRTSinfo (t,BS)
%  
%   Author: vittorio lippi <vittorio_lippi@hotmail.com>
%   Created: 2021-03-12

function s = PRTSinfo (y,t)
% this version does not generalize over t
resp1=y;
ampRot= 1;
ampTrans = 0;

fb=([0,0,-1,1]); % Calc of the theoretical stimulus
seedx=([0 0 0 1]);
[x,x3out]=pseudogen3(4,fb,seedx,25);
prts=x3out*100/(max(x3out)-min(x3out));
ln=913;
prts=([prts(ln:end) prts(1:ln-1)])-prts(ln);
prts1=prts/max(prts);

stim.rot=[zeros(1,197),prts1*0.5,prts1*0.5,prts1*0.5,zeros(1,192)]; 
stim.trans=stim.rot;% dummy
TF = PRTS2012(stim,resp1,ampRot,ampTrans);   
FRF = TF.rot.tf;

%% compute human likeliness measure on the basis of reference human data
% values computed on EC TILT DATASET
S=diag([1,0.331373521580086,0.244170630839062,0.176813361212228,0.158255384340563,0.143019258172137,0.104908277222552,0.0821655856881506,0.0700324606487870,0.0462056556494213,0.0329904440826550]);
m=[2.58177313215413 + 0.699108811821831i,2.90136442271204 - 1.10281228500976i,2.48909158121414 - 1.86724169218275i,1.42033863052472 - 2.88931380556636i,0.127954729431264 - 2.92824132667351i,-0.820523322681814 - 2.13716096030909i,-1.10813754756134 - 0.944711594517997i,-0.789376176340471 - 0.337821891064970i,-0.532352350494783 - 0.124966893884923i,-0.230198015235802 + 0.0180083239296357i,-0.142711951591556 + 0.00180914852340031i];

Sigma=[1.30391543459364 + 0.00000000000000i,0.303801008822341 - 1.17786141864026i,-0.597001237067584 - 0.606994030537295i,-1.14521858578788 - 0.481865605739320i,-0.774486562084068 + 0.159814512675471i,-0.307200358942068 + 0.383148952146920i,0.185099516720091 + 0.293740769886951i,0.242940978656443 + 0.116035494935919i,0.172909086048108 - 0.0264595762881138i,0.0697891138710825 - 0.0400135140002747i,0.0380892878609927 - 0.0392837155224010i;0.303801008822341 + 1.17786141864026i,3.10458295959105 + 0.00000000000000i,0.783711333170108 - 1.02640047515399i,-0.280849512660944 - 2.16956147945041i,-0.896856672648435 - 1.16737740840956i,-0.868633938149946 - 0.262686082989185i,-0.264395217765415 + 0.317837497234178i,-0.0187031287056298 + 0.255753805254808i,0.103158871036815 + 0.235833768524893i,0.0625293326538785 + 0.0843661021480409i,0.0466583976940471 + 0.0749020141175699i;-0.597001237067584 + 0.606994030537295i,0.783711333170108 + 1.02640047515399i,2.86226134550551 + 0.00000000000000i,2.07112272443538 - 0.852263397395456i,0.219339290934695 - 1.40780929056657i,-0.456930720764074 - 1.03140120373305i,-0.576283102771283 - 0.0986203477674197i,-0.430334806876867 + 0.185856203351088i,-0.234750983670509 + 0.282397280512908i,0.0664285647707537 + 0.0775055522043128i,-0.0395180534592992 + 0.0575637408801230i;-1.14521858578788 + 0.481865605739320i,-0.280849512660944 + 2.16956147945041i,2.07112272443538 + 0.852263397395456i,4.59595776098293 + 0.00000000000000i,2.13037371603858 - 1.53262546595774i,0.113780221670384 - 1.65867854897424i,-0.745911582547467 - 0.509771210328516i,-0.652859706303603 + 0.150367825914240i,-0.382203516589454 + 0.290342158820967i,-0.152413747016519 + 0.00574296072649887i,-0.00978256265885938 + 0.0907922436519960i;-0.774486562084068 - 0.159814512675471i,-0.896856672648435 + 1.16737740840956i,0.219339290934695 + 1.40780929056657i,2.13037371603858 + 1.53262546595774i,2.38164247896320 + 0.00000000000000i,1.15857468676745 - 0.696315045241739i,-0.163165236439331 - 0.532403556293992i,-0.350256552747301 - 0.237397637074206i,-0.283222799431961 - 0.0591107868618552i,-0.132375606521356 - 0.0220481127698306i,-0.00445692374534819 + 0.0152183368081919i;-0.307200358942068 - 0.383148952146920i,-0.868633938149946 + 0.262686082989185i,-0.456930720764074 + 1.03140120373305i,0.113780221670384 + 1.65867854897424i,1.15857468676745 + 0.696315045241739i,1.37448328333005 + 0.00000000000000i,0.453732264908841 - 0.378174418978873i,-0.0552405592243188 - 0.382310176823953i,-0.153550373792265 - 0.186792130467372i,-0.0173992961260093 + 0.00472841996126817i,-0.0413114023931992 - 0.0256097802389972i;0.185099516720091 - 0.293740769886951i,-0.264395217765415 - 0.317837497234178i,-0.576283102771283 + 0.0986203477674197i,-0.745911582547467 + 0.509771210328516i,-0.163165236439331 + 0.532403556293992i,0.453732264908841 + 0.378174418978873i,0.716878970756060 + 0.00000000000000i,0.234098476995275 - 0.209994354012455i,0.0246876895446343 - 0.147995305494418i,-0.00406919138018098 - 0.0326920278031340i,-0.0284878322612763 - 0.0274201088414561i;0.242940978656443 - 0.116035494935919i,-0.0187031287056298 - 0.255753805254808i,-0.430334806876867 - 0.185856203351088i,-0.652859706303603 - 0.150367825914240i,-0.350256552747301 + 0.237397637074206i,-0.0552405592243188 + 0.382310176823953i,0.234098476995275 + 0.209994354012455i,0.280801932451379 + 0.00000000000000i,0.123849943217377 - 0.0888069333696348i,-0.00556968635650864 - 0.0216637286991952i,-0.00237778576321997 - 0.0358599465169404i;0.172909086048108 + 0.0264595762881138i,0.103158871036815 - 0.235833768524893i,-0.234750983670509 - 0.282397280512908i,-0.382203516589454 - 0.290342158820967i,-0.283222799431961 + 0.0591107868618552i,-0.153550373792265 + 0.186792130467372i,0.0246876895446343 + 0.147995305494418i,0.123849943217377 + 0.0888069333696348i,0.149211536398228 + 0.00000000000000i,0.0130753841824489 - 0.0272811011191184i,0.0207754349744029 - 0.0208545599845724i;0.0697891138710825 + 0.0400135140002747i,0.0625293326538785 - 0.0843661021480409i,0.0664285647707537 - 0.0775055522043128i,-0.152413747016519 - 0.00574296072649887i,-0.132375606521356 + 0.0220481127698306i,-0.0173992961260093 - 0.00472841996126817i,-0.00406919138018098 + 0.0326920278031340i,-0.00556968635650864 + 0.0216637286991952i,0.0130753841824489 + 0.0272811011191184i,0.0928895641903273 + 0.00000000000000i,-0.00532037831065989 - 0.00719838814813993i;0.0380892878609927 + 0.0392837155224010i,0.0466583976940471 - 0.0749020141175699i,-0.0395180534592992 - 0.0575637408801230i,-0.00978256265885938 - 0.0907922436519960i,-0.00445692374534819 - 0.0152183368081919i,-0.0413114023931992 + 0.0256097802389972i,-0.0284878322612763 + 0.0274201088414561i,-0.00237778576321997 + 0.0358599465169404i,0.0207754349744029 + 0.0208545599845724i,-0.00532037831065989 + 0.00719838814813993i,0.0358122312593890 + 0.00000000000000i];
d= FRF-m;
D=abs(sqrt(d*S*Sigma*S'*d')); % abs() to prevent small imaginary values 
                        

s.score=D;
s.FRF=FRF;


