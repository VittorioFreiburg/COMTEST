%   This program is free software: you can redistribute it and/or modify it
%   under the terms of the GNU General Public License as published by
%   the Free Software Foundation, either version 3 of the License, or
%   (at your option) any later version.
%   
%   This program is distributed in the hope that it will be useful, but
%   WITHOUT ANY WARRANTY; without even the implied warranty of
%   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%   GNU General Public License for more details.
%   
%   You should have received a copy of the GNU General Public License
%   along with this program.  If not, see
%   <https://www.gnu.org/licenses/>.
%  
%   This function creates a structure with the PI(s) associated with the PRTS stimulus
%   s = PRTSinfo (t,BS)
%  
%   Author: vittorio lippi <vittorio_lippi@hotmail.com>
%   Created: 2021-03-12

function s = PRTSinfo (y,t)
% this version does not generalize over t
resp1=y;
ampRot= 1;
ampTrans = 0;

fb=([0,0,-1,1]); % Calc of the theoretical stimulus
seedx=([0 0 0 1]);
[x,x3out]=pseudogen3(4,fb,seedx,25);
prts=x3out*100/(max(x3out)-min(x3out));
ln=913;
prts=([prts(ln:end) prts(1:ln-1)])-prts(ln);
prts1=prts/max(prts);

stim.rot=[zeros(1,197),prts1*0.5,prts1*0.5,prts1*0.5,zeros(1,192)]; 
stim.trans=stim.rot;% dummy
TF = PRTS2012(stim,resp1,ampRot,ampTrans);   
FRF = TF.rot.tf;

%% compute human likeliness measure on the basis of reference human data
% values computed on EC TILT DATASET
S=diag([1,0.331373521580086,0.244170630839062,0.176813361212228,0.158255384340563,0.143019258172137,0.104908277222552,0.0821655856881506,0.0700324606487870,0.0462056556494213,0.0329904440826550]);
m=[2.88966411490562,4.30171276853011,3.07116433186756,1.65169885073674,0.355669696188084,-0.711948627331972,-1.46715506890365,-1.40695459041993,-1.13245256517045,-0.486213329009666,-0.168961443385927,1.26308497331590,-0.742698089727794,-2.93130086175759,-3.82175033192058,-3.67533247728104,-2.81078249234543,-1.67508865938885,-0.854190765914096,-0.169436767404806,0.243623304347569,0.148596044633691];
invSigma=[1.65555146433233,-0.0743859528674930,-0.159173396477947,0.251616028890373,-0.241034181730027,0.465238625091663,0.252106442139734,-0.255344111838048,0.373918059579025,-0.479223881426588,0.726193851590616,0.318302636484133,0.633539452492353,0.116796592899910,-0.0989487236656392,0.380893226893436,-0.142599885998538,0.0231288959456433,-0.0424693039536184,-1.04885752618067,0.283697974337906,0.202795489299636;-0.0743859528674930,0.637737900166818,-0.0798292131277895,0.116575306184696,-0.127252144637475,0.131691322496275,0.0666619259636417,0.338116657813819,-0.264182481961781,-0.00777724516963966,0.348843104917403,-0.0185637340067671,-0.00886091487689364,0.195380142057254,-0.0637899427763997,0.227842335375362,-0.197704056309993,-0.0137614484726346,0.0104115507992638,0.0655322314120353,0.326857539643826,-0.266660689220821;-0.159173396477947,-0.0798292131277895,0.756862422290946,-0.279806612594319,0.185127485372927,0.0994776425030845,-0.131720349398245,0.189820815958062,0.183678462091355,0.0177544574899737,-0.658659617017108,-0.193333687902760,-0.114322147437514,-0.0728290484514244,0.135177164427581,-0.0198721885181382,0.00543365216445108,-0.180403661735867,0.247913073664435,0.536387544157516,-0.0455158298934611,-0.559842332792321;0.251616028890373,0.116575306184696,-0.279806612594319,1.06252761313828,-1.06149893057748,0.765301780099984,-0.206967040281843,0.273888395045228,-0.159453100860005,-0.0868916669307105,-0.00433228410184182,-0.00397688508942540,0.141556959246335,-0.105291279332633,-0.0853201758707126,0.269020175107432,0.0195029487621079,0.0172557228824819,0.252439985200049,-0.262379837551954,0.234696694965528,-0.156169164378123;-0.241034181730027,-0.127252144637475,0.185127485372927,-1.06149893057748,3.01995341561413,-2.71753632596341,1.37865893311355,-0.735553773605844,-0.191625671515790,-0.209278303373577,0.155634170485781,0.593947440024040,-0.131914480771180,-0.298823976909908,0.302890262066204,-0.393739627412920,0.643195646944508,0.142786057131060,-0.302949808253132,-0.284615885744407,-0.320348355885992,-1.51624487821402;0.465238625091663,0.131691322496275,0.0994776425030845,0.765301780099984,-2.71753632596341,4.38954545043642,-2.07945233941084,1.80887436186455,0.474316078943591,0.496194586649714,0.0675058843773789,-0.292385892887444,0.269893624410432,0.230731326933476,-0.192568601744687,0.133447299450626,-0.490047251124890,0.286186782488282,0.785467375105949,0.299277254206290,-0.0596510478617399,2.15528555472312;0.252106442139734,0.0666619259636417,-0.131720349398245,-0.206967040281843,1.37865893311355,-2.07945233941084,4.25752417078317,-3.76859648427348,0.995533582335334,-0.507046210364734,0.265754413376286,0.343719607557762,-9.37386189298894e-05,-0.0853423481768414,0.176004443643555,-0.317724038323918,0.470630906293544,0.447931192980566,-0.479961186590734,-0.745937260228593,1.12173114620033,-2.01461021402023;-0.255344111838048,0.338116657813819,0.189820815958062,0.273888395045228,-0.735553773605844,1.80887436186455,-3.76859648427348,10.2072080806529,-4.83408537631055,2.46229723881097,1.43850599147053,-0.00359209357757463,-0.200917023440395,-0.185737369492744,0.304458229054068,-0.406965010980982,0.0355350927456568,-1.91280281112027,2.39363099142045,0.589735518767877,-0.692142916120112,4.81201665447022;0.373918059579025,-0.264182481961781,0.183678462091355,-0.159453100860005,-0.191625671515790,0.474316078943591,0.995533582335334,-4.83408537631055,13.9784930348644,-3.98309462692585,0.463513405870911,-0.201197546543605,0.136744168120505,0.228575796912953,-0.527599488224277,0.825052451709232,-1.52007043578937,-0.764130305424687,-0.671565896542615,0.738772853781688,5.32105621107350,3.41866266280854;-0.479223881426588,-0.00777724516963966,0.0177544574899737,-0.0868916669307105,-0.209278303373577,0.496194586649714,-0.507046210364734,2.46229723881097,-3.98309462692585,20.8652121432848,-3.62113513250004,0.487004168442588,-0.189798371714114,0.204489801312223,0.0941640936091905,-0.691141574251426,-0.310053904643100,0.515107607347084,-1.59682342985341,-2.90162772820488,2.43814400716697,5.22718170162958;0.726193851590616,0.348843104917403,-0.658659617017108,-0.00433228410184182,0.155634170485781,0.0675058843773789,0.265754413376286,1.43850599147053,0.463513405870911,-3.62113513250004,41.3430416535730,0.133902489393279,0.0524645111754600,0.108671487388959,-0.0240852037783830,-1.59713943268249,0.613963602268303,-3.03674630195700,1.56474210067579,-4.95277339381717,-4.96481543587654,4.32769474479659;0.318302636484133,-0.0185637340067671,-0.193333687902760,-0.00397688508942540,0.593947440024040,-0.292385892887444,0.343719607557762,-0.00359209357757463,-0.201197546543605,0.487004168442588,0.133902489393279,1.73752448984712,0.172035599535107,0.171117639816693,-0.00387249895873720,0.285610718377118,-0.0598959346429863,0.260029115630190,-0.224402587733141,-0.453156797695670,-0.0831953731704258,-0.0280117278180415;0.633539452492353,-0.00886091487689364,-0.114322147437514,0.141556959246335,-0.131914480771180,0.269893624410432,-9.37386189298894e-05,-0.200917023440395,0.136744168120505,-0.189798371714114,0.0524645111754600,0.172035599535107,0.913578145504167,-0.0285275322959195,0.0501892118190464,0.212043793199558,0.203838784428552,0.126003038163086,0.300064266367987,-0.463376940951623,0.372709358197624,-0.169514482966974;0.116796592899910,0.195380142057254,-0.0728290484514244,-0.105291279332633,-0.298823976909908,0.230731326933476,-0.0853423481768414,-0.185737369492744,0.228575796912953,0.204489801312223,0.108671487388959,0.171117639816693,-0.0285275322959195,0.726210766854945,-0.482105758193247,0.608163945473527,-0.571675656327167,0.292468635215050,-0.135694822703521,0.356070871422193,0.0190886738275889,0.789534112331849;-0.0989487236656392,-0.0637899427763997,0.135177164427581,-0.0853201758707126,0.302890262066204,-0.192568601744687,0.176004443643555,0.304458229054068,-0.527599488224277,0.0941640936091905,-0.0240852037783830,-0.00387249895873720,0.0501892118190464,-0.482105758193247,0.908107659779847,-1.09539672414262,1.04760638294487,-0.441944831178430,0.526682663740307,0.0876502676381535,-0.377869942086794,-0.977957378329076;0.380893226893436,0.227842335375362,-0.0198721885181382,0.269020175107432,-0.393739627412920,0.133447299450626,-0.317724038323918,-0.406965010980982,0.825052451709232,-0.691141574251426,-1.59713943268249,0.285610718377118,0.212043793199558,0.608163945473527,-1.09539672414262,3.24723627693685,-2.91424767245447,1.87532436504296,-0.753427760112559,0.0457977508065704,0.902830018294679,0.888878846341514;-0.142599885998538,-0.197704056309993,0.00543365216445108,0.0195029487621079,0.643195646944508,-0.490047251124890,0.470630906293544,0.0355350927456568,-1.52007043578937,-0.310053904643100,0.613963602268303,-0.0598959346429863,0.203838784428552,-0.571675656327167,1.04760638294487,-2.91424767245447,5.04754490523749,-3.04299240408981,2.33119509422228,-0.711983852666203,-1.37309093700204,-1.62512140614633;0.0231288959456433,-0.0137614484726346,-0.180403661735867,0.0172557228824819,0.142786057131060,0.286186782488282,0.447931192980566,-1.91280281112027,-0.764130305424687,0.515107607347084,-3.03674630195700,0.260029115630190,0.126003038163086,0.292468635215050,-0.441944831178430,1.87532436504296,-3.04299240408981,6.80642074415528,-4.53049134069076,1.42242149239710,0.208160828992498,0.157420942422969;-0.0424693039536184,0.0104115507992638,0.247913073664435,0.252439985200049,-0.302949808253132,0.785467375105949,-0.479961186590734,2.39363099142045,-0.671565896542615,-1.59682342985341,1.56474210067579,-0.224402587733141,0.300064266367987,-0.135694822703521,0.526682663740307,-0.753427760112559,2.33119509422228,-4.53049134069076,8.05710475598883,-3.83140597231427,-0.791354613525467,1.71393164087039;-1.04885752618067,0.0655322314120353,0.536387544157516,-0.262379837551954,-0.284615885744407,0.299277254206290,-0.745937260228593,0.589735518767877,0.738772853781688,-2.90162772820488,-4.95277339381717,-0.453156797695670,-0.463376940951623,0.356070871422193,0.0876502676381535,0.0457977508065704,-0.711983852666203,1.42242149239710,-3.83140597231427,13.0755952829645,1.11684074497453,-4.35009611490460;0.283697974337906,0.326857539643826,-0.0455158298934611,0.234696694965528,-0.320348355885992,-0.0596510478617399,1.12173114620033,-0.692142916120112,5.32105621107350,2.43814400716697,-4.96481543587654,-0.0831953731704258,0.372709358197624,0.0190886738275889,-0.377869942086794,0.902830018294679,-1.37309093700204,0.208160828992498,-0.791354613525467,1.11684074497453,10.5543435080795,4.43243534007609;0.202795489299636,-0.266660689220821,-0.559842332792321,-0.156169164378123,-1.51624487821402,2.15528555472312,-2.01461021402023,4.81201665447022,3.41866266280854,5.22718170162958,4.32769474479659,-0.0280117278180415,-0.169514482966974,0.789534112331849,-0.977957378329076,0.888878846341514,-1.62512140614633,0.157420942422969,1.71393164087039,-4.35009611490460,4.43243534007609,26.4532141380107];

d= realcoeff(FRF)-m;
D=abs(sqrt(d*S*invSigma*S'*d')); % abs() to prevent small imaginary values 
                        

s.score=D;
s.FRF=FRF;


