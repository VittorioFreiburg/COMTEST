<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="118,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">delta_out</span>, <span class="var type1" id="S3T1U4">bias</span>] = headingFilter_extrap(<span class="var type1" id="S4T12U7">delta</span>, <span class="var type1" id="S5T12U8">rating</span>, <span class="var type2" id="S6T3V2U9">estimation_rate</span>,<span class="var type1" id="S7T12U10">tau_bias</span>,<span class="var type1" id="S8T12U11">tau_delta</span>,<span class="var type1" id="S9T3U12">minRating</span>,<span class="var type2" id="S10T3V8U13">window_time</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="118,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% tau_bias = 8; % tuning parameter: time constant for bias filter %15</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% tau_delta = 15; % tuning parameter: time constant for heading filter %30</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%minRating = 0.4; % tuning parameter: extrapolating if rating &lt; minRating</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T12:U10"><span class="var type1" id="S4T12U16">delta</span> = <span class="mxinfo " id="T12:U12">unwrap(<span class="var type1" id="S4T12U19">delta</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T3:U14"><span class="var type1" id="S12T3U22">N</span> = <span class="mxinfo " id="T3:U16">length(<span class="var type1" id="S4T12U25">delta</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T3:U18"><span class="var type1" id="S14T3U28">Ts</span> = <span class="mxinfo " id="T3:U20">1/<span class="var type1" id="S6T3U31">estimation_rate</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T1:U22"><span class="var type1" id="S15T1U34">out</span> = <span class="mxinfo " id="T1:U24">zeros(<span class="var type1" id="S12T3U37">N</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T1:U26"><span class="var type1" id="S2T1U41">delta_out</span> = <span class="mxinfo " id="T1:U28">zeros(<span class="var type1" id="S12T3U44">N</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T1:U30"><span class="var type1" id="S3T1U48">bias</span> = <span class="mxinfo " id="T1:U32">zeros(<span class="var type1" id="S12T3U51">N</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T3:U34"><span class="var type1" id="S17T3U55">window_size</span> = <span class="mxinfo " id="T3:U36"><span class="var type1" id="S10T3U57">window_time</span>*<span class="var type1" id="S6T3U58">estimation_rate</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T12:U39"><span class="var type1" id="S18T12U61">k_bias</span> = <span class="mxinfo " id="T12:U41"><span class="mxinfo " id="T3:U42">1</span>-<span class="mxinfo " id="T12:U43">exp(<span class="mxinfo " id="T12:U44">-<span class="var type1" id="S14T3U69">Ts</span>*log(2)./<span class="var type1" id="S7T12U73">tau_bias</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T12:U47"><span class="var type1" id="S21T12U76">k_delta</span> = <span class="mxinfo " id="T12:U49"><span class="mxinfo " id="T3:U50">1</span>-<span class="mxinfo " id="T12:U51">exp(<span class="mxinfo " id="T12:U52">-<span class="var type1" id="S14T3U84">Ts</span>*log(2)./<span class="var type1" id="S8T12U88">tau_delta</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,18" id="srcline18">18</a></span><span class="line"><span class="comment">% if(length(tau_delta)==1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,19" id="srcline19">19</a></span><span class="line"><span class="comment">%     k_delta_new = repmat(k_delta,length(rating),1);    </span></span></span>
<span class="srcline"><span class="lineno"><a href="118,20" id="srcline20">20</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,21" id="srcline21">21</a></span><span class="line"><span class="comment">% if(length(tau_bias)==1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,22" id="srcline22">22</a></span><span class="line"><span class="comment">%     k_bias_new = repmat(k_bias,length(rating),1);    </span></span></span>
<span class="srcline"><span class="lineno"><a href="118,23" id="srcline23">23</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T76:U55"><span class="var type1" id="S22T76U91">k_delta_new</span> = <span class="mxinfo " id="T76:U57">repmat(<span class="var type1" id="S21T12U94">k_delta</span>,<span class="mxinfo " id="T3:U59">length(<span class="var type1" id="S5T12U97">rating</span>)</span>,1)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="118,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T76:U61"><span class="var type1" id="S24T76U101">k_bias_new</span> = <span class="mxinfo " id="T76:U63">repmat(<span class="var type1" id="S18T12U104">k_bias</span>,<span class="mxinfo " id="T3:U65">length(<span class="var type1" id="S5T12U107">rating</span>)</span>,1)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="118,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T12:U67"><span class="mxinfo " id="T12:U68"><span class="var type1" id="S5T12U112">rating</span>(<span class="mxinfo " id="T77:U70"><span class="var type1" id="S5T12U114">rating</span>&lt;<span class="var type1" id="S9T3U115">minRating</span></span>)</span> = <span class="mxinfo " id="T3:U73">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T3:U74"><span class="mxinfo " id="T3:U75"><span class="var type1" id="S15T1U120">out</span>(<span class="mxinfo " id="T3:U77">1</span>)</span> = <span class="mxinfo " id="T3:U78"><span class="var type1" id="S4T12U123">delta</span>(<span class="mxinfo " id="T3:U80">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,34" id="srcline34">34</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S25T3U127">i</span>=<span class="mxinfo " id="T3:U82">2</span>:<span class="var type1" id="S12T3U130">N</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,35" id="srcline35">35</a></span><span class="line"><span class="comment">%     bias(i) = bias(i-1) + rating(i) * max(k_bias(i), 1/i) * (wrapToPi(delta(i) - delta(i-1)) - bias(i-1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,36" id="srcline36">36</a></span><span class="line">    <span class="keyword">if</span>(<span class="mxinfo " id="T9:U84"><span class="mxinfo " id="T3:U85">length(<span class="var type1" id="S7T12U137">tau_bias</span>)</span>==<span class="mxinfo " id="T3:U87">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="118,37" id="srcline37">37</a></span><span class="line">        <span class="mxinfo " id="T3:U88"><span class="mxinfo " id="T3:U89"><span class="var type1" id="S3T1U142">bias</span>(<span class="var type1" id="S25T3U143">i</span>)</span> = <span class="mxinfo " id="T3:U92"><span class="mxinfo " id="T3:U93"><span class="var type1" id="S3T1U146">bias</span>(<span class="mxinfo " id="T3:U95"><span class="var type1" id="S25T3U148">i</span>-<span class="mxinfo " id="T3:U97">1</span></span>)</span> + <span class="mxinfo " id="T3:U98"><span class="mxinfo " id="T3:U99"><span class="mxinfo " id="T3:U100"><span class="var type1" id="S5T12U153">rating</span>(<span class="var type1" id="S25T3U154">i</span>)</span> * <span class="mxinfo " id="T3:U103">max(<span class="mxinfo " id="T3:U104"><span class="var type1" id="S22T76U158">k_delta_new</span>(<span class="var type1" id="S25T3U159">i</span>)</span>, <span class="mxinfo " id="T3:U107"><span class="mxinfo " id="T3:U108">1</span>/<span class="var type1" id="S25T3U162">i</span></span>)</span></span> * (<span class="mxinfo " id="T3:U110"><span class="mxinfo " id="T3:U111"><span class="fcn" id="F403N19:B166">local_wrapToPi</span>(<span class="mxinfo " id="T3:U112"><span class="mxinfo " id="T3:U113"><span class="var type1" id="S4T12U169">delta</span>(<span class="var type1" id="S25T3U170">i</span>)</span> - <span class="mxinfo " id="T3:U116"><span class="var type1" id="S4T12U172">delta</span>(<span class="mxinfo " id="T3:U118"><span class="var type1" id="S25T3U174">i</span>-<span class="mxinfo " id="T3:U120">1</span></span>)</span></span>)</span> - <span class="mxinfo " id="T3:U121"><span class="var type1" id="S3T1U177">bias</span>(<span class="mxinfo " id="T3:U123"><span class="var type1" id="S25T3U179">i</span>-<span class="mxinfo " id="T3:U125">1</span></span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,38" id="srcline38">38</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,39" id="srcline39">39</a></span><span class="line">        <span class="mxinfo " id="T3:U126"><span class="mxinfo " id="T3:U127"><span class="var type1" id="S3T1U185">bias</span>(<span class="var type1" id="S25T3U186">i</span>)</span> = <span class="mxinfo " id="T3:U130"><span class="mxinfo " id="T3:U131"><span class="var type1" id="S3T1U189">bias</span>(<span class="mxinfo " id="T3:U133"><span class="var type1" id="S25T3U191">i</span>-<span class="mxinfo " id="T3:U135">1</span></span>)</span> + <span class="mxinfo " id="T3:U136"><span class="mxinfo " id="T3:U137"><span class="mxinfo " id="T3:U138"><span class="var type1" id="S5T12U196">rating</span>(<span class="var type1" id="S25T3U197">i</span>)</span> * <span class="mxinfo " id="T3:U141">max(<span class="mxinfo " id="T3:U142"><span class="var type1" id="S18T12U201">k_bias</span>(<span class="var type1" id="S25T3U202">i</span>)</span>, <span class="mxinfo " id="T3:U145"><span class="mxinfo " id="T3:U146">1</span>/<span class="var type1" id="S25T3U205">i</span></span>)</span></span> * (<span class="mxinfo " id="T3:U148"><span class="mxinfo " id="T3:U149"><span class="fcn" id="F403N19:B209">local_wrapToPi</span>(<span class="mxinfo " id="T3:U150"><span class="mxinfo " id="T3:U151"><span class="var type1" id="S4T12U212">delta</span>(<span class="var type1" id="S25T3U213">i</span>)</span> - <span class="mxinfo " id="T3:U154"><span class="var type1" id="S4T12U215">delta</span>(<span class="mxinfo " id="T3:U156"><span class="var type1" id="S25T3U217">i</span>-<span class="mxinfo " id="T3:U158">1</span></span>)</span></span>)</span> - <span class="mxinfo " id="T3:U159"><span class="var type1" id="S3T1U220">bias</span>(<span class="mxinfo " id="T3:U161"><span class="var type1" id="S25T3U222">i</span>-<span class="mxinfo " id="T3:U163">1</span></span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,40" id="srcline40">40</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,41" id="srcline41">41</a></span><span class="line">    <span class="keyword">if</span>(<span class="mxinfo " id="T9:U164"><span class="mxinfo " id="T3:U165">length(<span class="var type1" id="S8T12U230">tau_delta</span>)</span>==<span class="mxinfo " id="T3:U167">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="118,42" id="srcline42">42</a></span><span class="line">        <span class="mxinfo " id="T3:U168"><span class="mxinfo " id="T3:U169"><span class="var type1" id="S15T1U235">out</span>(<span class="var type1" id="S25T3U236">i</span>)</span> = <span class="mxinfo " id="T3:U172"><span class="mxinfo " id="T3:U173"><span class="mxinfo " id="T3:U174"><span class="var type1" id="S15T1U240">out</span>(<span class="mxinfo " id="T3:U176"><span class="var type1" id="S25T3U242">i</span>-<span class="mxinfo " id="T3:U178">1</span></span>)</span> + <span class="mxinfo " id="T3:U179"><span class="var type1" id="S3T1U245">bias</span>(<span class="var type1" id="S25T3U246">i</span>)</span></span> + <span class="mxinfo " id="T3:U182"><span class="mxinfo " id="T3:U183"><span class="mxinfo " id="T3:U184"><span class="var type1" id="S5T12U250">rating</span>(<span class="var type1" id="S25T3U251">i</span>)</span> * <span class="mxinfo " id="T3:U187">max(<span class="mxinfo " id="T3:U188"><span class="var type1" id="S24T76U255">k_bias_new</span>(<span class="var type1" id="S25T3U256">i</span>)</span>, <span class="mxinfo " id="T3:U191"><span class="mxinfo " id="T3:U192">1</span>/<span class="var type1" id="S25T3U259">i</span></span>)</span></span> * (<span class="mxinfo " id="T3:U194"><span class="mxinfo " id="T3:U195"><span class="fcn" id="F403N19:B263">local_wrapToPi</span>(<span class="mxinfo " id="T3:U196"><span class="mxinfo " id="T3:U197"><span class="var type1" id="S4T12U266">delta</span>(<span class="var type1" id="S25T3U267">i</span>)</span> - <span class="mxinfo " id="T3:U200"><span class="var type1" id="S15T1U269">out</span>(<span class="mxinfo " id="T3:U202"><span class="var type1" id="S25T3U271">i</span>-<span class="mxinfo " id="T3:U204">1</span></span>)</span></span>)</span> - <span class="mxinfo " id="T3:U205"><span class="var type1" id="S3T1U274">bias</span>(<span class="var type1" id="S25T3U275">i</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,43" id="srcline43">43</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,44" id="srcline44">44</a></span><span class="line">        <span class="mxinfo " id="T3:U208"><span class="mxinfo " id="T3:U209"><span class="var type1" id="S15T1U280">out</span>(<span class="var type1" id="S25T3U281">i</span>)</span> = <span class="mxinfo " id="T3:U212"><span class="mxinfo " id="T3:U213"><span class="mxinfo " id="T3:U214"><span class="var type1" id="S15T1U285">out</span>(<span class="mxinfo " id="T3:U216"><span class="var type1" id="S25T3U287">i</span>-<span class="mxinfo " id="T3:U218">1</span></span>)</span> + <span class="mxinfo " id="T3:U219"><span class="var type1" id="S3T1U290">bias</span>(<span class="var type1" id="S25T3U291">i</span>)</span></span> + <span class="mxinfo " id="T3:U222"><span class="mxinfo " id="T3:U223"><span class="mxinfo " id="T3:U224"><span class="var type1" id="S5T12U295">rating</span>(<span class="var type1" id="S25T3U296">i</span>)</span> * <span class="mxinfo " id="T3:U227">max(<span class="mxinfo " id="T3:U228"><span class="var type1" id="S21T12U300">k_delta</span>(<span class="var type1" id="S25T3U301">i</span>)</span>, <span class="mxinfo " id="T3:U231"><span class="mxinfo " id="T3:U232">1</span>/<span class="var type1" id="S25T3U304">i</span></span>)</span></span> * (<span class="mxinfo " id="T3:U234"><span class="mxinfo " id="T3:U235"><span class="fcn" id="F403N19:B308">local_wrapToPi</span>(<span class="mxinfo " id="T3:U236"><span class="mxinfo " id="T3:U237"><span class="var type1" id="S4T12U311">delta</span>(<span class="var type1" id="S25T3U312">i</span>)</span> - <span class="mxinfo " id="T3:U240"><span class="var type1" id="S15T1U314">out</span>(<span class="mxinfo " id="T3:U242"><span class="var type1" id="S25T3U316">i</span>-<span class="mxinfo " id="T3:U244">1</span></span>)</span></span>)</span> - <span class="mxinfo " id="T3:U245"><span class="var type1" id="S3T1U319">bias</span>(<span class="var type1" id="S25T3U320">i</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="118,45" id="srcline45">45</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo " id="T3:U248"><span class="mxinfo " id="T3:U249"><span class="var type1" id="S2T1U324">delta_out</span>(<span class="var type1" id="S25T3U325">i</span>)</span> = <span class="mxinfo " id="T3:U252"><span class="mxinfo " id="T3:U253"><span class="var type1" id="S15T1U328">out</span>(<span class="var type1" id="S25T3U329">i</span>)</span> + <span class="mxinfo " id="T3:U256"><span class="mxinfo " id="T3:U257"><span class="var type1" id="S17T3U332">window_size</span>/<span class="mxinfo " id="T3:U259">2</span></span> * <span class="mxinfo " id="T3:U260"><span class="var type1" id="S3T1U335">bias</span>(<span class="var type1" id="S25T3U336">i</span>)</span></span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="118,47" id="srcline47">47</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="118,48" id="srcline48">48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,49" id="srcline49">49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,50" id="srcline50">50</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="118,51" id="srcline51">51</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
